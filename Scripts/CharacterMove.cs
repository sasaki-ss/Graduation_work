using UnityEngine;
using UnityEngine.AI;

public class CharacterMove : MonoBehaviour
{
    //ステータス取得用
    public CharaStatus CharaStatus;

    //理解はしてないけど3d空間上でのClick座標を取得するのに使う
    RaycastHit hit;

    //キャラ
    [SerializeField] Transform player;
    Vector3 a;
    void Update()
    {
        //左クリックしたら
        if (Input.GetMouseButtonDown(0))
        {
            MoveToCursor();
        }

        //現座標と前座標に違う場合
        if (player.position != a)
        {
            //移動中ならスタミナ減少(今いる座標と目的地の座標のズレが1以上の場合)
            if (hit.point.x - player.position.x < -1)
            {
                CharaStatus.CharaStamina = CharaStatus.CharaStamina - 0.001f;
            }

            if (hit.point.x - player.position.x > 1)
            {
                CharaStatus.CharaStamina = CharaStatus.CharaStamina - 0.001f;
            }

            if (hit.point.y - player.position.y < -1)
            {
                CharaStatus.CharaStamina = CharaStatus.CharaStamina - 0.001f;
            }

            if (hit.point.y - player.position.y > 1)
            {
                CharaStatus.CharaStamina = CharaStatus.CharaStamina - 0.001f;
            }

            if (hit.point.z - player.position.z < -1)
            {
                CharaStatus.CharaStamina = CharaStatus.CharaStamina - 0.001f;
            }

            if (hit.point.z - player.position.z > 1)
            {
                CharaStatus.CharaStamina = CharaStatus.CharaStamina - 0.001f;
            }
        }

        a = player.position;
    }

    private void MoveToCursor()
    {
        //カメラの場所とマウスのClick座標からZ座標を求める
        Ray ray = Camera.main.ScreenPointToRay(Input.mousePosition);
        bool hasHit = Physics.Raycast(ray, out hit);

        //Clickした場所まで移動
        if (hasHit)
        {
            GetComponent<NavMeshAgent>().destination = hit.point;
        }
    }
}